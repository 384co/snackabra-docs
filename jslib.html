<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="Snackabra Server" href="server.html" /><link rel="prev" title="LICENSE" href="license.html" />

    <!-- Generated with Sphinx 5.3.0 and Furo 2023.03.27 -->
        <title>SB JSLib - snackabra 0.5.x beta documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?digest=fad236701ea90a88636c2a8c73b44ae642ed2a53" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    <link rel="stylesheet" type="text/css" href="_static/css/custom.css" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">snackabra 0.5.x beta documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">snackabra 0.5.x beta documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Technical Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="system-architecture.html">System Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="discussion.html">Background and Discussion</a></li>
<li class="toctree-l1"><a class="reference internal" href="formal.html">Formal Treatment</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="contact.html">Contact and Feedback</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="future.html">Future Work</a></li>
<li class="toctree-l1"><a class="reference internal" href="references.html">References / Further Reading</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">LICENSE</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">SB JSLib</a></li>
<li class="toctree-l1"><a class="reference internal" href="server.html">Snackabra Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="pylib.html">Python Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendix-a-crypto.html">Appendix A: Cryptography</a></li>
<li class="toctree-l1"><a class="reference internal" href="user-guide.html">Appendix B: Privacy.App Chat Room User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="diag-sample.html">(ignore)</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="sb-jslib">
<h1>SB JSLib<a class="headerlink" href="#sb-jslib" title="Permalink to this heading">#</a></h1>
<p><cite>The core of SB is implemented in snackabra.ts, targeting ES2022.
This section documents the JS (translated) version. Please note:
any current published version is Alpha of upcoming 0.5.0 and should
not be used for sensitive or production use (or if you do use it as
such: caveat emptor). We will signal production-ready use by versioning
it as 1.0.x (published to npmjs).</cite></p>
<dl class="simple">
<dt><a href="#id1"><span class="problematic" id="id2">`</span></a>We are still trying to sort out how to get Sphinx, JSDoc, Typedoc,</dt><dd><p>etc to all play nice together in a good way…`</p>
</dd>
</dl>
<p>All core capababilities of the SB design is intended to be encapsulated
in this library. Design objectives include: <a class="footnote-reference brackets" href="#id6" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a></p>
<ul class="simple">
<li><p>No external dependencies (no other libraries)</p></li>
<li><p>No dependencies on the DOM object</p></li>
<li><p>Pure asynchronous (eg no ‘await’)</p></li>
<li><p>Clean es2022 code</p></li>
<li><p>Zero errors/warnings on tsc ‘strict’ setting</p></li>
<li><p>Minimum “forced typecasting”</p></li>
<li><p>DRY extendable / abstract OOP implementation</p></li>
</ul>
<section id="installation-development">
<h2>Installation / Development<a class="headerlink" href="#installation-development" title="Permalink to this heading">#</a></h2>
<p>Install with:</p>
<p><code class="docutils literal notranslate"><span class="pre">npm</span> <span class="pre">i</span> <span class="pre">-g</span> <span class="pre">snackabra</span></code></p>
<p>Git repository: <a class="reference external" href="https://github.com/snackabra/snackabra-jslib.git">https://github.com/snackabra/snackabra-jslib.git</a></p>
<p>Note: in SB version 0.5.0, most core SB client and server
logic is being refactored into this library. If you’re looking
at this prior to release of 0.5.0 (link above), then the latest
(in progress) version underlying this documentation is here:</p>
<p><a class="reference external" href="https://github.com/384co/snackabra-docs/blob/main/snackabra-jslib/snackabra.js">https://github.com/384co/snackabra-docs/blob/main/snackabra-jslib/snackabra.js</a></p>
</section>
<section id="sb384">
<h2>SB384<a class="headerlink" href="#sb384" title="Permalink to this heading">#</a></h2>
<p>Most classes in SB are rooted in SB384. It encapsulates the core of an
“identifier” in SB, namely a (384-bit) global <a class="reference internal" href="glossary.html#term-channel-name"><span class="xref std std-term">Channel Name</span></a>, derived
from the <a class="reference internal" href="glossary.html#term-Owner-Key"><span class="xref std std-term">Owner Key</span></a> of that object - typically either a <a class="reference internal" href="glossary.html#term-channel"><span class="xref std std-term">channel</span></a>
or a <a class="reference internal" href="glossary.html#term-object"><span class="xref std std-term">object</span></a>. Most of the properties (see getters below) are various
perspectives and formats on this identity.</p>
<dl class="js class">
<dt class="sig sig-object js" id="SB384">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="n"><span class="pre">SB384</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#SB384" title="Permalink to this definition">#</a></dt>
<dd><p>Basic (core) capability object in SB.</p>
<p>Note that all the getters below will throw an exception if the
corresponding information is not ready.</p>
<p>Like most SB classes, SB384 follows the “ready template” design
pattern: the object is immediately available upon creation,
but isn’t “ready” until it says it’s ready. See <a class="reference internal" href="#channel-class">Channel Class</a>
example below.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>key</strong> – a jwk with which to create identity; if not provided, it will ‘mint’ (generate) them randomly, in other words it will default to creating a new identity (“384”).</p></li>
</ul>
</dd>
</dl>
<dl class="js attribute">
<dt class="sig sig-object js" id="SB384._id">
<span class="sig-prename descclassname"><span class="n"><span class="pre">SB384</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">_id</span></span></span><a class="headerlink" href="#SB384._id" title="Permalink to this definition">#</a></dt>
<dd><p><strong>type:</strong> JsonWebKey</p>
</dd></dl>

<dl class="js attribute">
<dt class="sig sig-object js" id="SB384.exportable_privateKey">
<span class="sig-prename descclassname"><span class="n"><span class="pre">SB384</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">exportable_privateKey</span></span></span><a class="headerlink" href="#SB384.exportable_privateKey" title="Permalink to this definition">#</a></dt>
<dd><p><strong>type:</strong> JsonWebKey</p>
</dd></dl>

<dl class="js attribute">
<dt class="sig sig-object js" id="SB384.exportable_pubKey">
<span class="sig-prename descclassname"><span class="n"><span class="pre">SB384</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">exportable_pubKey</span></span></span><a class="headerlink" href="#SB384.exportable_pubKey" title="Permalink to this definition">#</a></dt>
<dd><p><strong>type:</strong> JsonWebKey</p>
</dd></dl>

<dl class="js attribute">
<dt class="sig sig-object js" id="SB384.keyPair">
<span class="sig-prename descclassname"><span class="n"><span class="pre">SB384</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">keyPair</span></span></span><a class="headerlink" href="#SB384.keyPair" title="Permalink to this definition">#</a></dt>
<dd><p><strong>type:</strong> CryptoKeyPair</p>
</dd></dl>

<dl class="js attribute">
<dt class="sig sig-object js" id="SB384.ownerChannelId">
<span class="sig-prename descclassname"><span class="n"><span class="pre">SB384</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">ownerChannelId</span></span></span><a class="headerlink" href="#SB384.ownerChannelId" title="Permalink to this definition">#</a></dt>
<dd><p><strong>type:</strong> string</p>
</dd></dl>

<dl class="js attribute">
<dt class="sig sig-object js" id="SB384.privateKey">
<span class="sig-prename descclassname"><span class="n"><span class="pre">SB384</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">privateKey</span></span></span><a class="headerlink" href="#SB384.privateKey" title="Permalink to this definition">#</a></dt>
<dd><p><strong>type:</strong> CryptoKey</p>
</dd></dl>

<dl class="js attribute">
<dt class="sig sig-object js" id="SB384.readyFlag">
<span class="sig-prename descclassname"><span class="n"><span class="pre">SB384</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">readyFlag</span></span></span><a class="headerlink" href="#SB384.readyFlag" title="Permalink to this definition">#</a></dt>
<dd><p><strong>type:</strong> boolean</p>
</dd></dl>

</dd></dl>

</section>
<section id="snackabra-server-class">
<h2>Snackabra (Server) Class<a class="headerlink" href="#snackabra-server-class" title="Permalink to this heading">#</a></h2>
<p id="snackabra">The SB class is the orchestrator, in particular it tracks one or more channels
connecting to one or more SB servers.</p>
<dl class="js class">
<dt class="sig sig-object js" id="Snackabra">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="n"><span class="pre">Snackabra</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">args</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Snackabra" title="Permalink to this definition">#</a></dt>
<dd><p>Constructor expects an object with the names of the matching servers, for example
below shows the miniflare local dev config. Note that ‘new Snackabra()’ is
guaranteed synchronous, so can be ‘used’ right away. You can optionally call
without a parameter in which case SB will ping known servers.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="n">channel_server</span><span class="p">:</span> <span class="s1">&#39;http://127.0.0.1:4001&#39;</span><span class="p">,</span>
  <span class="n">channel_ws</span><span class="p">:</span> <span class="s1">&#39;ws://127.0.0.1:4001&#39;</span><span class="p">,</span>
  <span class="n">storage_server</span><span class="p">:</span> <span class="s1">&#39;http://127.0.0.1:4000&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>args</strong> (<em>DEBUG</em>) – server names (optional)</p></li>
<li><p><strong>args</strong> – if set to true, will make ALL jslib calls verbose in the console</p></li>
</ul>
</dd>
</dl>
<dl class="js function">
<dt class="sig sig-object js" id="Snackabra.create">
<span class="sig-prename descclassname"><span class="n"><span class="pre">Snackabra</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">create</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sbServer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">serverSecret</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">keys</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Snackabra.create" title="Permalink to this definition">#</a></dt>
<dd><p>Creates a new channel. Currently uses trivial authentication.
Returns a promise to a ‘’SBChannelHandle’’ object
(which includes the <a class="reference internal" href="glossary.html#term-channel-name"><span class="xref std std-term">Channel Name</span></a>).
Note that this method does not connect to the channel,
it just creates (authorizes) it.</p>
</dd></dl>

</dd></dl>

</section>
<section id="interfaces">
<h2>Interfaces<a class="headerlink" href="#interfaces" title="Permalink to this heading">#</a></h2>
<p>TODO: how to get SBServer (and interfaces and types) over here.</p>
</section>
<section id="channels">
<h2>Channels<a class="headerlink" href="#channels" title="Permalink to this heading">#</a></h2>
<p>Channels (aka “Rooms”) are the core communication primitive in SB.</p>
<section id="sb-message-class">
<h3>SB Message Class<a class="headerlink" href="#sb-message-class" title="Permalink to this heading">#</a></h3>
<span class="target" id="sbmessage"></span><dl class="js class">
<dt class="sig sig-object js" id="SBMessage">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="n"><span class="pre">SBMessage</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">channel</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">body</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#SBMessage" title="Permalink to this definition">#</a></dt>
<dd><dl class="js function">
<dt class="sig sig-object js" id="SBMessage.send">
<span class="sig-prename descclassname"><span class="n"><span class="pre">SBMessage</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">send</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">message</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#SBMessage.send" title="Permalink to this definition">#</a></dt>
<dd><p>SBMessage.send()</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>message</strong> (<a class="reference internal" href="#SBMessage" title="SBMessage"><em>SBMessage</em></a>) – the message object to send</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="channel-class">
<h3>Channel Class<a class="headerlink" href="#channel-class" title="Permalink to this heading">#</a></h3>
<dl class="js class">
<dt class="sig sig-object js" id="Channel">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="n"><span class="pre">Channel</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sbServer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key?</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">channelId</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#Channel" title="Permalink to this definition">#</a></dt>
<dd><p>Join a channel, returns channel object.</p>
<p>Currently, you must have an identity when connecting, because every single
message is signed by sender. TODO is to look at how to provide a ‘listening’
mode on channels.</p>
<p>Most classes in SB follow the “ready” template: objects can be used
right away, but they decide for themselves if they’re ready or not.</p>
<p>Below is a (complete) example for reference:</p>
<blockquote>
<div><pre class="literal-block">//
// Here we create a new channel; for this we need to be specific
// about what servers to use. This example references local dev
// (miniflare) servers
//
const sb_config = {
  channel_server: 'http://localhost:4001',
  channel_ws: 'ws://localhost:4001',
  storage_server: 'http://localhost:4000'
}
//
// Next we create the orchestrator object, for above endpoints
//
const SB = new <a class="reference internal" href="#snackabra">Snackabra</a> (sb_config)
//
// On these servers, we create a new channel (trivial auth)
//
SB.create(sb_config, '&lt;SECRET&gt;').then((handle) =&gt; {
  //
  // This will return a 'handle', a type that contains all
  // the information you need to keep reference a channel.
  //
  SB.connect(
    //
    // Above we've created a channel, but not connected.
    // Besides some information in the handle, to connect we
    // must provide a message handler for all (new) messages
    //
    (m: ChannelMessage) =&gt; { console.log(`got message: ${m}`) },
    handle.key,
    handle.channelId
  ).then((c) =&gt; c.ready).then((c) =&gt; {
    //
    // We are now connected, 'c' is a <a class="reference internal" href="#channel-socket-class">Channel Socket Class</a>
    // and can (optionally) pick a name (alias) for ourselves
    //
    c.userName = &quot;TestBot&quot;
    //
    // We can now send messages
    //
    (new <a class="reference internal" href="#sbmessage">SBMessage</a> (c, &quot;Hello from TestBot!&quot;)).send().then((c) =&gt; {
      console.log(`test message sent! (${c})`) })
  })
})</pre>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sbServer</strong> (<a class="reference internal" href="#Snackabra" title="Snackabra"><em>Snackabra</em></a>) – server to join</p></li>
<li><p><strong>key?</strong> (<em>JsonWebKey</em>) – key to use to join (optional)</p></li>
<li><p><strong>channelId</strong> (<em>string</em>) – (the <a class="reference internal" href="glossary.html#term-channel-name"><span class="xref std std-term">Channel Name</span></a>) to find on that server (optional)</p></li>
</ul>
</dd>
</dl>
<dl class="js attribute">
<dt class="sig sig-object js" id="Channel.api">
<span class="sig-prename descclassname"><span class="n"><span class="pre">Channel</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">api</span></span></span><a class="headerlink" href="#Channel.api" title="Permalink to this definition">#</a></dt>
<dd><p><strong>type:</strong> ChannelApi</p>
</dd></dl>

<dl class="js attribute">
<dt class="sig sig-object js" id="Channel.channelId">
<span class="sig-prename descclassname"><span class="n"><span class="pre">Channel</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">channelId</span></span></span><a class="headerlink" href="#Channel.channelId" title="Permalink to this definition">#</a></dt>
<dd><p><strong>type:</strong> string</p>
</dd></dl>

<dl class="js attribute">
<dt class="sig sig-object js" id="Channel.readyFlag">
<span class="sig-prename descclassname"><span class="n"><span class="pre">Channel</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">readyFlag</span></span></span><a class="headerlink" href="#Channel.readyFlag" title="Permalink to this definition">#</a></dt>
<dd><p><strong>type:</strong> boolean</p>
</dd></dl>

<dl class="js attribute">
<dt class="sig sig-object js" id="Channel.sbServer">
<span class="sig-prename descclassname"><span class="n"><span class="pre">Channel</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">sbServer</span></span></span><a class="headerlink" href="#Channel.sbServer" title="Permalink to this definition">#</a></dt>
<dd><p><strong>type:</strong> SBServer</p>
</dd></dl>

</dd></dl>

</section>
<section id="channel-socket-class">
<h3>Channel Socket Class<a class="headerlink" href="#channel-socket-class" title="Permalink to this heading">#</a></h3>
<p>Channel “sockets” are the synchronous communication interface to channels.</p>
<dl class="js class">
<dt class="sig sig-object js" id="ChannelSocket">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="n"><span class="pre">ChannelSocket</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sbServer:</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ChannelSocket" title="Permalink to this definition">#</a></dt>
<dd><p>ChannelSocket</p>
<blockquote>
<div><p>Class managing connections</p>
</div></blockquote>
<p>ChannelSocket</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sbServer:</strong> (<em>SBServer</em>) – </p></li>
</ul>
</dd>
</dl>
<dl class="js attribute">
<dt class="sig sig-object js" id="ChannelSocket.ChannelSocket">
<span class="sig-prename descclassname"><span class="n"><span class="pre">ChannelSocket</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">ChannelSocket</span></span></span><a class="headerlink" href="#ChannelSocket.ChannelSocket" title="Permalink to this definition">#</a></dt>
<dd><p>ChannelSocket</p>
</dd></dl>

<dl class="js attribute">
<dt class="sig sig-object js" id="ChannelSocket.exportable_owner_pubKey">
<span class="sig-prename descclassname"><span class="n"><span class="pre">ChannelSocket</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">exportable_owner_pubKey</span></span></span><a class="headerlink" href="#ChannelSocket.exportable_owner_pubKey" title="Permalink to this definition">#</a></dt>
<dd><p><strong>type:</strong> JsonWebKey</p>
</dd></dl>

<dl class="js attribute">
<dt class="sig sig-object js" id="ChannelSocket.keys">
<span class="sig-prename descclassname"><span class="n"><span class="pre">ChannelSocket</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">keys</span></span></span><a class="headerlink" href="#ChannelSocket.keys" title="Permalink to this definition">#</a></dt>
<dd><p>ChannelSocket.keys</p>
<p>Will throw an exception if keys are unknown or not yet loaded</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="ChannelSocket.send">
<span class="sig-prename descclassname"><span class="n"><span class="pre">ChannelSocket</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">send</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">msg</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ChannelSocket.send" title="Permalink to this definition">#</a></dt>
<dd><p>ChannelSocket.send()</p>
<p>Returns a promise that resolves to “success” when sent,
or an error message if it fails.</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="ChannelSocket.sendSbObject">
<span class="sig-prename descclassname"><span class="n"><span class="pre">ChannelSocket</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">sendSbObject</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ChannelSocket.sendSbObject" title="Permalink to this definition">#</a></dt>
<dd><p>ChannelSocket.sendSbObject()</p>
<p>Send SB object (file) on channel socket</p>
</dd></dl>

</dd></dl>

</section>
<section id="channel-api-class">
<h3>Channel API Class<a class="headerlink" href="#channel-api-class" title="Permalink to this heading">#</a></h3>
<p>The channel “API” class is the asynchronous interface to channels.</p>
<dl class="js class">
<dt class="sig sig-object js" id="ChannelApi">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="n"><span class="pre">ChannelApi</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">channel</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ChannelApi" title="Permalink to this definition">#</a></dt>
<dd><dl class="js function">
<dt class="sig sig-object js" id="ChannelApi.downloadData">
<span class="sig-prename descclassname"><span class="n"><span class="pre">ChannelApi</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">downloadData</span></span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ChannelApi.downloadData" title="Permalink to this definition">#</a></dt>
<dd><p>downloadData</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="ChannelApi.getAdminData">
<span class="sig-prename descclassname"><span class="n"><span class="pre">ChannelApi</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">getAdminData</span></span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ChannelApi.getAdminData" title="Permalink to this definition">#</a></dt>
<dd><p>getAdminData</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="ChannelApi.getCapacity">
<span class="sig-prename descclassname"><span class="n"><span class="pre">ChannelApi</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">getCapacity</span></span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ChannelApi.getCapacity" title="Permalink to this definition">#</a></dt>
<dd><p>getCapacity</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="ChannelApi.getJoinRequests">
<span class="sig-prename descclassname"><span class="n"><span class="pre">ChannelApi</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">getJoinRequests</span></span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ChannelApi.getJoinRequests" title="Permalink to this definition">#</a></dt>
<dd><p>getJoinRequests</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="ChannelApi.getLastMessageTimes">
<span class="sig-prename descclassname"><span class="n"><span class="pre">ChannelApi</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">getLastMessageTimes</span></span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ChannelApi.getLastMessageTimes" title="Permalink to this definition">#</a></dt>
<dd><p>getLastMessageTimes</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="ChannelApi.getOldMessages">
<span class="sig-prename descclassname"><span class="n"><span class="pre">ChannelApi</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">getOldMessages</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">currentMessagesLength</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ChannelApi.getOldMessages" title="Permalink to this definition">#</a></dt>
<dd><p>getOldMessages</p>
<dl class="simple">
<dt>TODO: this needs to be able to check that the channel socket</dt><dd><p>is ready, otherwise the keys might not be … currently
before calling this, make a ready check on the socket</p>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="ChannelApi.isLocked">
<span class="sig-prename descclassname"><span class="n"><span class="pre">ChannelApi</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">isLocked</span></span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#ChannelApi.isLocked" title="Permalink to this definition">#</a></dt>
<dd><p>isLocked</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="ChannelApi.setMOTD">
<span class="sig-prename descclassname"><span class="n"><span class="pre">ChannelApi</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">setMOTD</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">motd</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ChannelApi.setMOTD" title="Permalink to this definition">#</a></dt>
<dd><p>Set message of the day</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="ChannelApi.updateCapacity">
<span class="sig-prename descclassname"><span class="n"><span class="pre">ChannelApi</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">updateCapacity</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">capacity</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ChannelApi.updateCapacity" title="Permalink to this definition">#</a></dt>
<dd><p>Update (set) the capacity of the channel; Owner only</p>
</dd></dl>

</dd></dl>

</section>
</section>
<section id="storage">
<h2>Storage<a class="headerlink" href="#storage" title="Permalink to this heading">#</a></h2>
<section id="sb-storage-class">
<h3>SB Storage Class<a class="headerlink" href="#sb-storage-class" title="Permalink to this heading">#</a></h3>
<dl class="js class">
<dt class="sig sig-object js" id="StorageApi">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="n"><span class="pre">StorageApi</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">server</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">channelServer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shardServer</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#StorageApi" title="Permalink to this definition">#</a></dt>
<dd><dl class="js function">
<dt class="sig sig-object js" id="StorageApi.getObjectMetadata">
<span class="sig-prename descclassname"><span class="n"><span class="pre">StorageApi</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">getObjectMetadata</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">buf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">type</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">roomId</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#StorageApi.getObjectMetadata" title="Permalink to this definition">#</a></dt>
<dd></dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="StorageApi.retrieveImage">
<span class="sig-prename descclassname"><span class="n"><span class="pre">StorageApi</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">retrieveImage</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">imageMetaData</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">controlMessages</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">imageId</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">imageKey</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">imageType</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#StorageApi.retrieveImage" title="Permalink to this definition">#</a></dt>
<dd><p>StorageApi().retrieveData()
retrieves an object from storage</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="StorageApi.saveFile">
<span class="sig-prename descclassname"><span class="n"><span class="pre">StorageApi</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">saveFile</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">channel</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sbFile</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#StorageApi.saveFile" title="Permalink to this definition">#</a></dt>
<dd><p>StorageApi.saveFile()</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="StorageApi.storeData">
<span class="sig-prename descclassname"><span class="n"><span class="pre">StorageApi</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">storeData</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">type</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fileId</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">iv</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">salt</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">storageToken</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#StorageApi.storeData" title="Permalink to this definition">#</a></dt>
<dd><p>StorageApi().storeData()</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="StorageApi.storeImage">
<span class="sig-prename descclassname"><span class="n"><span class="pre">StorageApi</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">storeImage</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">keyData</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">type</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#StorageApi.storeImage" title="Permalink to this definition">#</a></dt>
<dd><p>StorageApi().storeImage()</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="StorageApi.storeObject">
<span class="sig-prename descclassname"><span class="n"><span class="pre">StorageApi</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">storeObject</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">buf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">type</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">roomId</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#StorageApi.storeObject" title="Permalink to this definition">#</a></dt>
<dd><p>StorageApi.storeObject</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="StorageApi.storeRequest">
<span class="sig-prename descclassname"><span class="n"><span class="pre">StorageApi</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">storeRequest</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fileId</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#StorageApi.storeRequest" title="Permalink to this definition">#</a></dt>
<dd><p>StorageApi().storeRequest</p>
</dd></dl>

</dd></dl>

</section>
<section id="sb-file-class">
<h3>SB File Class<a class="headerlink" href="#sb-file-class" title="Permalink to this heading">#</a></h3>
<dl class="js class">
<dt class="sig sig-object js" id="SBFile">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="n"><span class="pre">SBFile</span></span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#SBFile" title="Permalink to this definition">#</a></dt>
<dd><dl class="js attribute">
<dt class="sig sig-object js" id="SBFile.SBFile">
<span class="sig-prename descclassname"><span class="n"><span class="pre">SBFile</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">SBFile</span></span></span><a class="headerlink" href="#SBFile.SBFile" title="Permalink to this definition">#</a></dt>
<dd></dd></dl>

</dd></dl>

<p>Sample usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> const SB = new Snackabra(sb_config)
 SB.create(
   &#39;password&#39;,
   (new Identity())).then((channelId) =&gt; {
     SB.connect(
       channelId,
       (m: ChannelMessage) =&gt; { console.log(`got message: ${m}`)}
     ).then((c) =&gt; c.ready).then((c) =&gt; {
       c.userName = &quot;TestBot&quot; // optional
       (new SBMessage(c, &quot;Hello Message!&quot;)).send().then((c) =&gt; { console.log(`sent! (${c})`) })
    })
  })
}
</pre></div>
</div>
</section>
</section>
<section id="utilities-and-helpers">
<h2>Utilities and Helpers<a class="headerlink" href="#utilities-and-helpers" title="Permalink to this heading">#</a></h2>
<p>These are a set common operations, that typically are supported by the
web api, but where we want to ensure specific behavior.</p>
<section id="crypto-class">
<h3>Crypto Class<a class="headerlink" href="#crypto-class" title="Permalink to this heading">#</a></h3>
<dl class="js class">
<dt class="sig sig-object js" id="SBCrypto">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="n"><span class="pre">SBCrypto</span></span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#SBCrypto" title="Permalink to this definition">#</a></dt>
<dd><dl class="js function">
<dt class="sig sig-object js" id="SBCrypto.ab2str">
<span class="sig-prename descclassname"><span class="n"><span class="pre">SBCrypto</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">ab2str</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">buffer</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#SBCrypto.ab2str" title="Permalink to this definition">#</a></dt>
<dd><p>Standardized ‘ab2str()’ function, array buffer to string.
This assumes one byte per character.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>buffer</strong> (<em>Uint8Array</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>string</strong> – string</p>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="SBCrypto.compareKeys">
<span class="sig-prename descclassname"><span class="n"><span class="pre">SBCrypto</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">compareKeys</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key2</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#SBCrypto.compareKeys" title="Permalink to this definition">#</a></dt>
<dd><p>SBCrypto.compareKeys()</p>
<p>Compare JSON keys, true if the ‘same’, false if different.</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="SBCrypto.deriveKey">
<span class="sig-prename descclassname"><span class="n"><span class="pre">SBCrypto</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">deriveKey</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">privateKey</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">publicKey</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">type</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extractable</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">keyUsages</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#SBCrypto.deriveKey" title="Permalink to this definition">#</a></dt>
<dd><p>SBCrypto.deriveKey()</p>
<p>Derive key.</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="SBCrypto.extractPubKey">
<span class="sig-prename descclassname"><span class="n"><span class="pre">SBCrypto</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">extractPubKey</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">privateKey</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#SBCrypto.extractPubKey" title="Permalink to this definition">#</a></dt>
<dd><p>Extracts (generates) public key from a private key.</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="SBCrypto.generateKeys">
<span class="sig-prename descclassname"><span class="n"><span class="pre">SBCrypto</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">generateKeys</span></span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#SBCrypto.generateKeys" title="Permalink to this definition">#</a></dt>
<dd><p>SBCrypto.generatekeys()</p>
<p>Generates standard <code class="docutils literal notranslate"><span class="pre">ECDH</span></code> keys using <code class="docutils literal notranslate"><span class="pre">P-384</span></code>.</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="SBCrypto.importKey">
<span class="sig-prename descclassname"><span class="n"><span class="pre">SBCrypto</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">importKey</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">format</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">type</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extractable</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">keyUsages</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#SBCrypto.importKey" title="Permalink to this definition">#</a></dt>
<dd><p>SBCrypto.importKey()</p>
<p>Import keys</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="SBCrypto.sign">
<span class="sig-prename descclassname"><span class="n"><span class="pre">SBCrypto</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">sign</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">secretKey</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">contents</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#SBCrypto.sign" title="Permalink to this definition">#</a></dt>
<dd><p>SBCrypto.sign()</p>
<p>Sign</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="SBCrypto.str2ab">
<span class="sig-prename descclassname"><span class="n"><span class="pre">SBCrypto</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">str2ab</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">string</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#SBCrypto.str2ab" title="Permalink to this definition">#</a></dt>
<dd><p>Standardized ‘str2ab()’ function, string to array buffer.
This assumes on byte per character.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>string</strong> (<em>string</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>Uint8Array</strong> – buffer</p>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="SBCrypto.verify">
<span class="sig-prename descclassname"><span class="n"><span class="pre">SBCrypto</span></span><span class="p"><span class="pre">.</span></span></span><span class="sig-name descname"><span class="n"><span class="pre">verify</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">verifyKey</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sign</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">contents</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#SBCrypto.verify" title="Permalink to this definition">#</a></dt>
<dd><p>SBCrypto.verify()</p>
<p>Verify signature.</p>
</dd></dl>

</dd></dl>

</section>
<section id="format-related">
<h3>Format Related<a class="headerlink" href="#format-related" title="Permalink to this heading">#</a></h3>
<dl class="js function">
<dt class="sig sig-object js" id="arrayBufferToBase64">
<span class="sig-name descname"><span class="n"><span class="pre">arrayBufferToBase64</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ArrayBuffer</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#arrayBufferToBase64" title="Permalink to this definition">#</a></dt>
<dd><p>Standardized ‘btoa()’-like function, e.g., takes a binary string
(‘b’) and returns a Base64 encoded version (‘a’ used to be short
for ‘ascii’).</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ArrayBuffer</strong> (<em>bufferSource</em>) – buffer</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>string</strong> – base64 string</p>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="base64ToArrayBuffer">
<span class="sig-name descname"><span class="n"><span class="pre">base64ToArrayBuffer</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">base64</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#base64ToArrayBuffer" title="Permalink to this definition">#</a></dt>
<dd><p>Standardized ‘atob()’ function, e.g. takes the a Base64 encoded
input and decodes it. Note: always returns Uint8Array.
Accepts both regular Base64 and the URL-friendly variant,
where <cite>+</cite> =&gt; <cite>-</cite>, <cite>/</cite> =&gt; <cite>_</cite>, and the padding character is omitted.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>base64</strong> (<em>str</em>) – string in either regular or URL-friendly representation.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>Uint8Array</strong> – returns decoded binary result</p>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="encodeB64Url">
<span class="sig-name descname"><span class="n"><span class="pre">encodeB64Url</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#encodeB64Url" title="Permalink to this definition">#</a></dt>
<dd><p>Encode into b64 URL</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="decodeB64Url">
<span class="sig-name descname"><span class="n"><span class="pre">decodeB64Url</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#decodeB64Url" title="Permalink to this definition">#</a></dt>
<dd><p>Decode b64 URL</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="str2ab">
<span class="sig-name descname"><span class="n"><span class="pre">str2ab</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">string</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#str2ab" title="Permalink to this definition">#</a></dt>
<dd><p>Standardized ‘str2ab()’ function, string to array buffer.
This assumes on byte per character.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>string</strong> (<em>string</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>Uint8Array</strong> – buffer</p>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="ab2str">
<span class="sig-name descname"><span class="n"><span class="pre">ab2str</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">buffer</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#ab2str" title="Permalink to this definition">#</a></dt>
<dd><p>Standardized ‘ab2str()’ function, array buffer to string.
This assumes one byte per character.</p>
<dl class="field-list simple">
<dt class="field-odd">Arguments<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>buffer</strong> (<em>Uint8Array</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>string</strong> – string</p>
</dd>
</dl>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="cleanBase32mi">
<span class="sig-name descname"><span class="n"><span class="pre">cleanBase32mi</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">s</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#cleanBase32mi" title="Permalink to this definition">#</a></dt>
<dd><p>Disambiguates strings that are known to be ‘base32mi’ type</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;base32mi&#39;</span><span class="p">:</span> <span class="s1">&#39;0123456789abcdefyhEjkLmNHpFrRTUW&#39;</span>
</pre></div>
</div>
<p>This is the base32mi disambiguation table</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">OoQD</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="s1">&#39;0&#39;</span>
<span class="p">[</span><span class="n">lIiJ</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="s1">&#39;1&#39;</span>
<span class="p">[</span><span class="n">Zz</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="s1">&#39;2&#39;</span>
<span class="p">[</span><span class="n">A</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="s1">&#39;4&#39;</span>
<span class="p">[</span><span class="n">Ss</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="s1">&#39;5&#39;</span>
<span class="p">[</span><span class="n">G</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="s1">&#39;6&#39;</span>
<span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="s1">&#39;7&#39;</span>
<span class="p">[</span><span class="n">B</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="s1">&#39;8&#39;</span>
<span class="p">[</span><span class="n">gq</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="s1">&#39;9&#39;</span>
<span class="p">[</span><span class="n">C</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="s1">&#39;c&#39;</span>
<span class="p">[</span><span class="n">Y</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="s1">&#39;y&#39;</span>
<span class="p">[</span><span class="n">KxX</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="s1">&#39;k&#39;</span>
<span class="p">[</span><span class="n">M</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="s1">&#39;m&#39;</span>
<span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="s1">&#39;N&#39;</span>
<span class="p">[</span><span class="n">P</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="s1">&#39;p&#39;</span>
<span class="p">[</span><span class="n">uvV</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="s1">&#39;U&#39;</span>
<span class="p">[</span><span class="n">w</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="s1">&#39;W&#39;</span>
</pre></div>
</div>
</div></blockquote>
<p>Another way to think of it is this transform (‘.’ means no change):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">0123456789</span><span class="n">abcdefghijklmnopqrstuvxyzABCDEFGHIJKLMNOPQRSTUVXYZ</span>
<span class="o">...............</span><span class="mf">.9.1</span><span class="o">.</span><span class="mf">.1</span><span class="o">.</span><span class="n">N0</span><span class="mf">.9.57</span><span class="n">UUk</span><span class="mf">.248</span><span class="n">c0EF6</span><span class="mf">.11</span><span class="n">kLm</span><span class="mf">.0</span><span class="n">p0</span><span class="mf">.5</span><span class="o">..</span><span class="n">Uky2</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="crypto-helpers">
<h3>Crypto Helpers<a class="headerlink" href="#crypto-helpers" title="Permalink to this heading">#</a></h3>
</section>
<section id="sb-wire-format-helpers">
<h3>SB “Wire” Format Helpers<a class="headerlink" href="#sb-wire-format-helpers" title="Permalink to this heading">#</a></h3>
<dl class="js function">
<dt class="sig sig-object js" id="assemblePayload">
<span class="sig-name descname"><span class="n"><span class="pre">assemblePayload</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#assemblePayload" title="Permalink to this definition">#</a></dt>
<dd><p>Assemble payload</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="extractPayload">
<span class="sig-name descname"><span class="n"><span class="pre">extractPayload</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">payload</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#extractPayload" title="Permalink to this definition">#</a></dt>
<dd><p>Extract payload - this decodes from our binary (wire) format
to a JS object. This provides a binary encoding of any JSON,
and it allows some elements of the JSON to be raw (binary).</p>
</dd></dl>

</section>
<section id="sb-specific-helpers">
<h3>SB-specific Helpers<a class="headerlink" href="#sb-specific-helpers" title="Permalink to this heading">#</a></h3>
<dl class="js function">
<dt class="sig sig-object js" id="jsonParseWrapper">
<span class="sig-name descname"><span class="n"><span class="pre">jsonParseWrapper</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loc</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#jsonParseWrapper" title="Permalink to this definition">#</a></dt>
<dd><p>There are many problems with JSON parsing, adding a wrapper to capture more info.
The ‘loc’ parameter should be a (unique) string that allows you to find the usage
in the code; one approach is the line number in the file (at some point).</p>
</dd></dl>

<dl class="js function">
<dt class="sig sig-object js" id="partition">
<span class="sig-name descname"><span class="n"><span class="pre">partition</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#partition" title="Permalink to this definition">#</a></dt>
<dd><p>Partition</p>
</dd></dl>

</section>
<section id="testing-related">
<h3>Testing Related<a class="headerlink" href="#testing-related" title="Permalink to this heading">#</a></h3>
<dl class="js function">
<dt class="sig sig-object js" id="compareBuffers">
<span class="sig-name descname"><span class="n"><span class="pre">compareBuffers</span></span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">a</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">b</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#compareBuffers" title="Permalink to this definition">#</a></dt>
<dd><p>Compare buffers</p>
</dd></dl>

</section>
<section id="other">
<h3>Other<a class="headerlink" href="#other" title="Permalink to this heading">#</a></h3>
<p>TODO: add ‘’SBFetch’’ function.</p>
<hr class="docutils" />
<p class="rubric">Footnotes</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id4" role="note">
<span class="label"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></span>
<p>(test) This is the closest to DM (Direct Message) that the system
allows, since one constraint is that any communication must
include a responsible Owner.</p>
</aside>
<aside class="footnote brackets" id="id5" role="note">
<span class="label"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></span>
<p>(test) If the whisper is initiated by the guest. If whisper is
initiated by the owner, the key derivation uses the private
half of &lt;room&gt;_ownerKey and the public key of the
guest. The derived key remains the same in both cases.</p>
</aside>
<aside class="footnote brackets" id="id6" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">3</a><span class="fn-bracket">]</span></span>
<p>(test) In exchange for possible weaker security, since now the
Owner needs to keep track of their key files.</p>
</aside>
</aside>
<hr class="docutils" />
</section>
</section>
<section id="dn-004-the-ready-pattern">
<span id="dn004"></span><h2>DN 004: The “Ready” Pattern<a class="headerlink" href="#dn-004-the-ready-pattern" title="Permalink to this heading">#</a></h2>
<p>Unfortunately we have lost the original source from where we first
heard about the “ready” design pattern, and that source might have
called it something different.</p>
<p>The idea is to allow objects to be created immediately, but not
necessarily be “ready” to use, meaning that there might be some
asynchronous initialization that needs to be completed before the
object is ready to use.</p>
<p>Here is essentially how it works:</p>
<blockquote>
<div><div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">SomeClass</span><span class="p">()</span>
<span class="c1">// the object per se is created right away</span>

<span class="c1">// you can call any method on the object, but it will</span>
<span class="c1">// throw an exception if the object is not ready</span>
<span class="nx">obj</span><span class="p">.</span><span class="nx">someMethod</span><span class="p">()</span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">readyFlag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="c1">// you can explicitly check if an object is ready</span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="c1">// and if not, perhaps do something else</span>
<span class="p">}</span>

<span class="nx">obj</span><span class="p">.</span><span class="nx">ready</span><span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">obj</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="c1">// or you can set up what should be done when the object is ready</span>
<span class="p">})</span>
</pre></div>
</div>
<p>That’s the basic model. Creating an object is not a blocking operation,
but you can check if it is ready or not, and if not, you can either
wait for it to become ready, or you can move on and do something else.
If you call a method on an object that is not ready, it will throw an
exception.</p>
<p>The “readyFlag” value is set to true when the object is ready, and the
“ready” promise is resolved when the object is ready. The “ready”
promise is initialized by the constructor, so you also can do this:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">SomeClass</span><span class="p">()).</span><span class="nx">ready</span><span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">obj</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="c1">// do something with the object</span>
<span class="p">})</span>
</pre></div>
</div>
<p>Internally (inside jslib), part of this pattern is done by the
ready decorator, allowing things like getters to be succinct:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span>@Ready get privateKey() { return this.#privateKey }
</pre></div>
</div>
<p>This will automatically protect the getter from being called before
the internal state is ready, which in turn allows users of the library
to code more aggressively and not always have to explicitly
check if the object is ready or not.</p>
</div></blockquote>
</section>
<section id="dn-005-browser-connectivity">
<span id="dn005"></span><h2>DN 005: Browser connectivity<a class="headerlink" href="#dn-005-browser-connectivity" title="Permalink to this heading">#</a></h2>
<p>Unfortunately, browsers at the time of writing (February, 2023)
simply do not have a good way of checking network status. Currently
it comes down to this:</p>
<blockquote>
<div><ul>
<li><p>You cannot use ‘’XMLHttpRequest()’’ or ‘’fetch()’’ to “ping”
a server without it being noisy: for example, Chrome insists on
complaining (in red font) about ‘’ERR_CONNECTION_REFUSED’’ in the
developer console, no matter what you do in your javascript code.
The only way to turn that off is change default settings in the
browser developer tools setup.</p></li>
<li><p>You cannot use ‘’navigator.online’’ in all cases, because the
browser doesn’t consider a local server (on the same computer)
as a “server” per se, for this purpose, even though you can
connect to it.</p>
<p>The current net-net of this situation is that we chose not to
make jslib “proactive”, or “smart”, in this context. What we
can do, however, is “track” any of these errors, and print out
an info message on the console to ignore ‘’ERR_CONNECTION_REFUSED’’.</p>
<p>It would be nice if there was a simple api to check connectivity
to a server or an IP address. But it’s not something to be too
upset about: we’re pushing the browser behavior here pretty far
already. But it does mean that systems like Deno or Cloudflare’s
‘’workerd’’ will have to have additional non-browser APIs, just
like node needed … and then presumably browsers will add
incompatible versions of those …</p>
</li>
</ul>
</div></blockquote>
</section>
<section id="dn-006-localhost-cors-and-other-fun-things">
<h2>DN 006: Localhost, CORS, and other fun things<a class="headerlink" href="#dn-006-localhost-cors-and-other-fun-things" title="Permalink to this heading">#</a></h2>
<p>The browser has a concept of “same origin” policy, which means that
a web page can only access resources on the same server, or on a
different server, but only if the server explicitly allows it.</p>
<p>This plus some other issues adds up to these constraints:</p>
<ul class="simple">
<li><p>If you want a static (local) web page, e.g. a resource of type
“<a class="reference external" href="file://">file://</a>”, then it CANNOT load other resources locally - such as
a library (eg jslib itself). This is a security feature of the
browser, and it’s not likely to change.</p></li>
</ul>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="server.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Snackabra Server</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="license.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">LICENSE</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2019-2023, Magnusson Institute
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">SB JSLib</a><ul>
<li><a class="reference internal" href="#installation-development">Installation / Development</a></li>
<li><a class="reference internal" href="#sb384">SB384</a><ul>
<li><a class="reference internal" href="#SB384"><code class="docutils literal notranslate"><span class="pre">SB384</span></code></a><ul>
<li><a class="reference internal" href="#SB384._id"><code class="docutils literal notranslate"><span class="pre">SB384._id</span></code></a></li>
<li><a class="reference internal" href="#SB384.exportable_privateKey"><code class="docutils literal notranslate"><span class="pre">SB384.exportable_privateKey</span></code></a></li>
<li><a class="reference internal" href="#SB384.exportable_pubKey"><code class="docutils literal notranslate"><span class="pre">SB384.exportable_pubKey</span></code></a></li>
<li><a class="reference internal" href="#SB384.keyPair"><code class="docutils literal notranslate"><span class="pre">SB384.keyPair</span></code></a></li>
<li><a class="reference internal" href="#SB384.ownerChannelId"><code class="docutils literal notranslate"><span class="pre">SB384.ownerChannelId</span></code></a></li>
<li><a class="reference internal" href="#SB384.privateKey"><code class="docutils literal notranslate"><span class="pre">SB384.privateKey</span></code></a></li>
<li><a class="reference internal" href="#SB384.readyFlag"><code class="docutils literal notranslate"><span class="pre">SB384.readyFlag</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#snackabra-server-class">Snackabra (Server) Class</a><ul>
<li><a class="reference internal" href="#Snackabra"><code class="docutils literal notranslate"><span class="pre">Snackabra</span></code></a><ul>
<li><a class="reference internal" href="#Snackabra.create"><code class="docutils literal notranslate"><span class="pre">Snackabra.create()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#interfaces">Interfaces</a></li>
<li><a class="reference internal" href="#channels">Channels</a><ul>
<li><a class="reference internal" href="#sb-message-class">SB Message Class</a><ul>
<li><a class="reference internal" href="#SBMessage"><code class="docutils literal notranslate"><span class="pre">SBMessage</span></code></a><ul>
<li><a class="reference internal" href="#SBMessage.send"><code class="docutils literal notranslate"><span class="pre">SBMessage.send()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#channel-class">Channel Class</a><ul>
<li><a class="reference internal" href="#Channel"><code class="docutils literal notranslate"><span class="pre">Channel</span></code></a><ul>
<li><a class="reference internal" href="#Channel.api"><code class="docutils literal notranslate"><span class="pre">Channel.api</span></code></a></li>
<li><a class="reference internal" href="#Channel.channelId"><code class="docutils literal notranslate"><span class="pre">Channel.channelId</span></code></a></li>
<li><a class="reference internal" href="#Channel.readyFlag"><code class="docutils literal notranslate"><span class="pre">Channel.readyFlag</span></code></a></li>
<li><a class="reference internal" href="#Channel.sbServer"><code class="docutils literal notranslate"><span class="pre">Channel.sbServer</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#channel-socket-class">Channel Socket Class</a><ul>
<li><a class="reference internal" href="#ChannelSocket"><code class="docutils literal notranslate"><span class="pre">ChannelSocket</span></code></a><ul>
<li><a class="reference internal" href="#ChannelSocket.ChannelSocket"><code class="docutils literal notranslate"><span class="pre">ChannelSocket.ChannelSocket</span></code></a></li>
<li><a class="reference internal" href="#ChannelSocket.exportable_owner_pubKey"><code class="docutils literal notranslate"><span class="pre">ChannelSocket.exportable_owner_pubKey</span></code></a></li>
<li><a class="reference internal" href="#ChannelSocket.keys"><code class="docutils literal notranslate"><span class="pre">ChannelSocket.keys</span></code></a></li>
<li><a class="reference internal" href="#ChannelSocket.send"><code class="docutils literal notranslate"><span class="pre">ChannelSocket.send()</span></code></a></li>
<li><a class="reference internal" href="#ChannelSocket.sendSbObject"><code class="docutils literal notranslate"><span class="pre">ChannelSocket.sendSbObject()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#channel-api-class">Channel API Class</a><ul>
<li><a class="reference internal" href="#ChannelApi"><code class="docutils literal notranslate"><span class="pre">ChannelApi</span></code></a><ul>
<li><a class="reference internal" href="#ChannelApi.downloadData"><code class="docutils literal notranslate"><span class="pre">ChannelApi.downloadData()</span></code></a></li>
<li><a class="reference internal" href="#ChannelApi.getAdminData"><code class="docutils literal notranslate"><span class="pre">ChannelApi.getAdminData()</span></code></a></li>
<li><a class="reference internal" href="#ChannelApi.getCapacity"><code class="docutils literal notranslate"><span class="pre">ChannelApi.getCapacity()</span></code></a></li>
<li><a class="reference internal" href="#ChannelApi.getJoinRequests"><code class="docutils literal notranslate"><span class="pre">ChannelApi.getJoinRequests()</span></code></a></li>
<li><a class="reference internal" href="#ChannelApi.getLastMessageTimes"><code class="docutils literal notranslate"><span class="pre">ChannelApi.getLastMessageTimes()</span></code></a></li>
<li><a class="reference internal" href="#ChannelApi.getOldMessages"><code class="docutils literal notranslate"><span class="pre">ChannelApi.getOldMessages()</span></code></a></li>
<li><a class="reference internal" href="#ChannelApi.isLocked"><code class="docutils literal notranslate"><span class="pre">ChannelApi.isLocked()</span></code></a></li>
<li><a class="reference internal" href="#ChannelApi.setMOTD"><code class="docutils literal notranslate"><span class="pre">ChannelApi.setMOTD()</span></code></a></li>
<li><a class="reference internal" href="#ChannelApi.updateCapacity"><code class="docutils literal notranslate"><span class="pre">ChannelApi.updateCapacity()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#storage">Storage</a><ul>
<li><a class="reference internal" href="#sb-storage-class">SB Storage Class</a><ul>
<li><a class="reference internal" href="#StorageApi"><code class="docutils literal notranslate"><span class="pre">StorageApi</span></code></a><ul>
<li><a class="reference internal" href="#StorageApi.getObjectMetadata"><code class="docutils literal notranslate"><span class="pre">StorageApi.getObjectMetadata()</span></code></a></li>
<li><a class="reference internal" href="#StorageApi.retrieveImage"><code class="docutils literal notranslate"><span class="pre">StorageApi.retrieveImage()</span></code></a></li>
<li><a class="reference internal" href="#StorageApi.saveFile"><code class="docutils literal notranslate"><span class="pre">StorageApi.saveFile()</span></code></a></li>
<li><a class="reference internal" href="#StorageApi.storeData"><code class="docutils literal notranslate"><span class="pre">StorageApi.storeData()</span></code></a></li>
<li><a class="reference internal" href="#StorageApi.storeImage"><code class="docutils literal notranslate"><span class="pre">StorageApi.storeImage()</span></code></a></li>
<li><a class="reference internal" href="#StorageApi.storeObject"><code class="docutils literal notranslate"><span class="pre">StorageApi.storeObject()</span></code></a></li>
<li><a class="reference internal" href="#StorageApi.storeRequest"><code class="docutils literal notranslate"><span class="pre">StorageApi.storeRequest()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#sb-file-class">SB File Class</a><ul>
<li><a class="reference internal" href="#SBFile"><code class="docutils literal notranslate"><span class="pre">SBFile</span></code></a><ul>
<li><a class="reference internal" href="#SBFile.SBFile"><code class="docutils literal notranslate"><span class="pre">SBFile.SBFile</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#utilities-and-helpers">Utilities and Helpers</a><ul>
<li><a class="reference internal" href="#crypto-class">Crypto Class</a><ul>
<li><a class="reference internal" href="#SBCrypto"><code class="docutils literal notranslate"><span class="pre">SBCrypto</span></code></a><ul>
<li><a class="reference internal" href="#SBCrypto.ab2str"><code class="docutils literal notranslate"><span class="pre">SBCrypto.ab2str()</span></code></a></li>
<li><a class="reference internal" href="#SBCrypto.compareKeys"><code class="docutils literal notranslate"><span class="pre">SBCrypto.compareKeys()</span></code></a></li>
<li><a class="reference internal" href="#SBCrypto.deriveKey"><code class="docutils literal notranslate"><span class="pre">SBCrypto.deriveKey()</span></code></a></li>
<li><a class="reference internal" href="#SBCrypto.extractPubKey"><code class="docutils literal notranslate"><span class="pre">SBCrypto.extractPubKey()</span></code></a></li>
<li><a class="reference internal" href="#SBCrypto.generateKeys"><code class="docutils literal notranslate"><span class="pre">SBCrypto.generateKeys()</span></code></a></li>
<li><a class="reference internal" href="#SBCrypto.importKey"><code class="docutils literal notranslate"><span class="pre">SBCrypto.importKey()</span></code></a></li>
<li><a class="reference internal" href="#SBCrypto.sign"><code class="docutils literal notranslate"><span class="pre">SBCrypto.sign()</span></code></a></li>
<li><a class="reference internal" href="#SBCrypto.str2ab"><code class="docutils literal notranslate"><span class="pre">SBCrypto.str2ab()</span></code></a></li>
<li><a class="reference internal" href="#SBCrypto.verify"><code class="docutils literal notranslate"><span class="pre">SBCrypto.verify()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#format-related">Format Related</a><ul>
<li><a class="reference internal" href="#arrayBufferToBase64"><code class="docutils literal notranslate"><span class="pre">arrayBufferToBase64()</span></code></a></li>
<li><a class="reference internal" href="#base64ToArrayBuffer"><code class="docutils literal notranslate"><span class="pre">base64ToArrayBuffer()</span></code></a></li>
<li><a class="reference internal" href="#encodeB64Url"><code class="docutils literal notranslate"><span class="pre">encodeB64Url()</span></code></a></li>
<li><a class="reference internal" href="#decodeB64Url"><code class="docutils literal notranslate"><span class="pre">decodeB64Url()</span></code></a></li>
<li><a class="reference internal" href="#str2ab"><code class="docutils literal notranslate"><span class="pre">str2ab()</span></code></a></li>
<li><a class="reference internal" href="#ab2str"><code class="docutils literal notranslate"><span class="pre">ab2str()</span></code></a></li>
<li><a class="reference internal" href="#cleanBase32mi"><code class="docutils literal notranslate"><span class="pre">cleanBase32mi()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#crypto-helpers">Crypto Helpers</a></li>
<li><a class="reference internal" href="#sb-wire-format-helpers">SB “Wire” Format Helpers</a><ul>
<li><a class="reference internal" href="#assemblePayload"><code class="docutils literal notranslate"><span class="pre">assemblePayload()</span></code></a></li>
<li><a class="reference internal" href="#extractPayload"><code class="docutils literal notranslate"><span class="pre">extractPayload()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#sb-specific-helpers">SB-specific Helpers</a><ul>
<li><a class="reference internal" href="#jsonParseWrapper"><code class="docutils literal notranslate"><span class="pre">jsonParseWrapper()</span></code></a></li>
<li><a class="reference internal" href="#partition"><code class="docutils literal notranslate"><span class="pre">partition()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#testing-related">Testing Related</a><ul>
<li><a class="reference internal" href="#compareBuffers"><code class="docutils literal notranslate"><span class="pre">compareBuffers()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#other">Other</a></li>
</ul>
</li>
<li><a class="reference internal" href="#dn-004-the-ready-pattern">DN 004: The “Ready” Pattern</a></li>
<li><a class="reference internal" href="#dn-005-browser-connectivity">DN 005: Browser connectivity</a></li>
<li><a class="reference internal" href="#dn-006-localhost-cors-and-other-fun-things">DN 006: Localhost, CORS, and other fun things</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/scripts/furo.js"></script>
    </body>
</html>